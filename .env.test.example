# Census Terraform Provider - Test Environment Configuration
# Copy this file to .env.test and fill in your actual credentials
#
# IMPORTANT: .env.test is gitignored and should NEVER be committed
# This example file is safe to commit (contains only placeholders)

# ============================================================================
# Phase 1: Unit Tests
# ============================================================================
# Unit tests require NO credentials - they test pure Go logic
# These tests validate helper functions, data transformations, and internal logic
#
# Run with: make test-unit
#
# No configuration needed for unit tests!

# ============================================================================
# Phase 2: Integration Tests
# ============================================================================
# Integration tests create real resources in the Census staging environment
# They test the complete resource lifecycle: create → read → update → delete
#
# Run with: make test-integration
#
# What the tests do:
# - Create temporary workspaces (automatically cleaned up)
# - Create source connections (Redshift)
# - Create destination connections (Salesforce)
# - Create syncs connecting sources to destinations
# - Test field mappings, schedules, alerts, etc.
# - Verify all CRUD operations work correctly
# - Clean up all resources after tests complete

# Required for integration tests
TF_ACC=1

# ============================================================================
# Census Staging Environment
# ============================================================================

# Census staging API credentials
# Get your token from: https://app.staging.getcensus.com/settings/developer
CENSUS_BASE_URL=https://app.staging.getcensus.com/api/v1
CENSUS_PERSONAL_ACCESS_TOKEN=your-staging-personal-access-token-here

# ============================================================================
# Redshift Credentials (for source connection tests)
# ============================================================================
# Tests will create a Redshift source connection to verify connectivity
# Read-only access is sufficient - tests do NOT modify your data
# Use a test/dev Redshift cluster, not production

CENSUS_TEST_REDSHIFT_HOST=your-redshift-cluster.region.redshift.amazonaws.com
CENSUS_TEST_REDSHIFT_PORT=5439
CENSUS_TEST_REDSHIFT_DATABASE=dev
CENSUS_TEST_REDSHIFT_USERNAME=testuser
CENSUS_TEST_REDSHIFT_PASSWORD=your-password-here

# Optional: Schema for testing (defaults to public)
# CENSUS_TEST_REDSHIFT_SCHEMA=public

# ============================================================================
# Salesforce Credentials (for destination connection tests)
# ============================================================================
# IMPORTANT: Use a Salesforce SANDBOX, not production!
# Tests will create/delete Contact records for testing
# Get these from your Salesforce sandbox: Setup → My Personal Information

CENSUS_TEST_SALESFORCE_USERNAME=test@example.com.staging
CENSUS_TEST_SALESFORCE_PASSWORD=your-sandbox-password
CENSUS_TEST_SALESFORCE_SECURITY_TOKEN=your-security-token
CENSUS_TEST_SALESFORCE_SANDBOX=true

# ============================================================================
# Setup Instructions
# ============================================================================
#
# 1. Get Census staging credentials:
#    a. Go to https://app.staging.getcensus.com
#    b. Sign up for a staging account (if you don't have one)
#    c. Navigate to Settings → Developer → Personal Access Tokens
#    d. Create a new token with full permissions for testing
#    e. Copy the token to CENSUS_PERSONAL_ACCESS_TOKEN above
#
# 2. Set up Redshift test cluster:
#    a. Use an existing dev/test Redshift cluster
#    b. Create a test user with read-only access: CREATE USER testuser ...
#    c. Grant minimal permissions: GRANT SELECT ON ALL TABLES IN SCHEMA public TO testuser
#    d. Tests only need to validate connection - no data is modified
#    e. Fill in CENSUS_TEST_REDSHIFT_* variables above
#
# 3. Set up Salesforce sandbox:
#    a. Log into your Salesforce sandbox (not production!)
#    b. Go to Setup → My Personal Information → Reset Security Token
#    c. Check your email for the new security token
#    d. Fill in CENSUS_TEST_SALESFORCE_* variables above
#    e. Make sure CENSUS_TEST_SALESFORCE_SANDBOX=true
#
# 4. Copy and configure:
#    cp .env.test.example .env.test
#    # Edit .env.test with your actual credentials
#    # Never commit .env.test!
#
# 5. Run tests:
#    make test-unit          # Fast, no credentials needed
#    make test-integration   # Slower, requires setup above
#
# ============================================================================
# What Integration Tests Verify
# ============================================================================
#
# Resource Management:
#   ✓ Workspace creation, updates, deletion
#   ✓ Source connection creation (Redshift)
#   ✓ Destination connection creation (Salesforce)
#   ✓ Sync configuration with all features
#   ✓ Dataset creation and management
#
# Sync Features Tested:
#   ✓ Field mappings: direct, constant, liquid templates, sync metadata
#   ✓ Run modes: daily, hourly, weekly, manual schedules
#   ✓ Alerts: failure, invalid records, runtime, status
#   ✓ Source types: tables, datasets
#   ✓ Paused/unpaused states
#
# Data Sources:
#   ✓ Reading workspace information
#   ✓ Reading source connection details
#   ✓ Reading destination connection details
#   ✓ Reading sync configurations
#
# Advanced Operations:
#   ✓ Terraform import functionality
#   ✓ Resource updates and drift detection
#   ✓ Proper cleanup with CheckDestroy
#
# ============================================================================
# Troubleshooting
# ============================================================================
#
# Connection Errors:
#   - Verify your Redshift cluster allows connections from your IP
#   - Check Redshift security groups and network ACLs
#   - Confirm username/password are correct
#   - Try connecting with psql first to verify credentials
#
# Salesforce Errors:
#   - Ensure you're using a SANDBOX, not production
#   - Verify security token is current (reset if needed)
#   - Check that your Salesforce user has API access enabled
#   - Confirm password + security token combination is correct
#
# Census API Errors:
#   - Verify you're using staging URL: https://app.staging.getcensus.com
#   - Check that your personal access token hasn't expired
#   - Ensure token has full permissions for testing
#
# Test Failures:
#   - Check .env.test file exists and is properly formatted
#   - Verify TF_ACC=1 is set (required for integration tests)
#   - Review test output for specific error messages
#   - Try running with increased timeout: -timeout 120m
#
# ============================================================================
# CI/CD Configuration
# ============================================================================
#
# For GitHub Actions or other CI systems:
#
# 1. Add credentials as repository secrets:
#    - CENSUS_BASE_URL
#    - CENSUS_PERSONAL_ACCESS_TOKEN
#    - CENSUS_TEST_REDSHIFT_HOST
#    - CENSUS_TEST_REDSHIFT_PASSWORD
#    - CENSUS_TEST_SALESFORCE_PASSWORD
#    - CENSUS_TEST_SALESFORCE_SECURITY_TOKEN
#    (etc. for all required variables)
#
# 2. In your CI workflow, export as environment variables:
#    env:
#      TF_ACC: "1"
#      CENSUS_BASE_URL: ${{ secrets.CENSUS_BASE_URL }}
#      CENSUS_PERSONAL_ACCESS_TOKEN: ${{ secrets.CENSUS_PERSONAL_ACCESS_TOKEN }}
#      # ... other variables
#
# 3. Run tests:
#    - make test-unit (always run, fast)
#    - make test-integration (run on PR, slower)
#
# ============================================================================
